{% extends 'base.html' %}
{% block content %}

<div class="container-fluid">
    <div class="row">
    <nav class="col-md-2 d-none d-md-block bg-light sidebar"> <br>
        <h3>Filter</h3> <hr>
        <h4>Evaluations</h4>
        <select onchange="location = this.value;" class="selectpicker">
            <optgroup label="APT3">
            <option selected disabled >Select An Evaluation</option>
            {% for eval in evaluations.APT3 %}
                <option data-subtext="{{eval.apt}}" value="/results/{{eval.apt}}/{{eval.vendor}}">{{eval.vendor}}</option>
              {% endfor %}
            </optgroup>
            <optgroup label="APT29">
              <option data-divider="true"></option>
                {% for eval in evaluations.APT29 %}
                <option data-subtext="{{eval.apt}}" value="/results/{{eval.apt}}/{{eval.vendor}}">{{eval.vendor}}</option>
              {% endfor %}
            </optgroup>
        </select> <br><br>
        <h4>Tactics</h4>
        <select class="selectpicker" multiple>
            <option selected disabled >Coming Soon</option>
        </select> <br><br>
        <h4>Techniques</h4>
        <select class="selectpicker" multiple>
            <option selected disabled>Coming Soon</option>
        </select><br><br>
        <h4>Steps</h4>
        <select class="selectpicker" multiple>
            <option selected disabled>Coming Soon</option>
        </select><br><br>
        <h4>Sub Steps</h4>
        <select class="selectpicker" multiple>
            <option selected disabled>Coming Soon</option>
        </select><br><br>
    </nav>
        <main id="mainContentSection" role="main" class="col-md-9 ml-sm-auto col-lg-10 pt-3 px-4">
            <h3>{{apt}} - {{vendor}}</h3>
            <hr>
            <div class="card shadow p-3 mb-5 bg-white rounded">
              <div class="card-body">
                  <h5 class="card-title">Major Step Breakdown</h5>
               <div class="row"><canvas id="myChart"></canvas></div>
              </div>
            </div>
            <br><br>
            <div class="card shadow p-3 mb-5 bg-white rounded">
              <div class="card-body">
                  <h5 class="card-title">Sub Step Breakdown</h5>
               <div class="row"><canvas id="canvas"></canvas></div>
              </div>
            </div>

            <br><br>
           <div class="card shadow p-3 mb-5 bg-white rounded">
              <div class="card-body">
                  <h5 class="card-title">Modifiers Breakdown</h5>
                  <div class="row">
        <div class="col-sm">
            None
            <div class="row"><canvas width="600" height="300" id="donutChart"></canvas></div>
        </div>
        <div class="col-sm">
            Telemetry
            <div class="row"><canvas width="600" height="300" id="donutChart2"></canvas></div>
        </div>
        <div class="col-sm">
            General
            <div class="row"><canvas width="600" height="300" id="donutChart3"></canvas></div>
        </div>
        <div class="col-sm">
            Technique
            <div class="row"><canvas width="600" height="300" id="donutChart4"></canvas></div>
        </div>
        <div class="col-sm">
            Tactic
            <div class="row"><canvas width="600" height="300" id="donutChart5"></canvas></div>
        </div>
    </div>
              </div>
            </div>


        <hr>

        </main>
    </div>
        </div>



</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
<script>
var ctx = document.getElementById("myChart");

var myChart = new Chart(ctx, {
  type: 'bar',
  data: {
    labels: ['Step 1 - Initial Breach', "Step 2 - Rapid Collection and Exfiltration", "Step 3 - Deploy Stealth Toolkit", " Step 4 - Defense Evasion / Discovery", "Step 5 - Persistence", "Step 6 - Credential Access", "Step 7 - Collection and Exfiltration", "Step 8 - Lateral Movement", "Step 9 - Collection", "Step 10 - Persistence Execution", "Step 11 - Initial Compromise", "Step 12 - Fortify Access", "Step 13 - Local Enumeration", "Step 14 - Elevation", "Step 15 - Establish Persistence", "Step 16 -  Lateral Movement", "Step 17 - Collection", "Step 18 - Exfiltration", "Step 19 - Clean Up", "Step 20 - Leverage Persistence"],
    datasets: [
    {
        label: 'None',
        data: {{counts.none.count}},
        backgroundColor:
          'rgba(129, 130, 133, 1)',
      },{
        label: 'Telemetry',
        data: {{counts.telemetry.count}},
        backgroundColor:
          'rgba(88, 88, 90, 1)',
      },{
        label: 'General',
        data:  {{counts.general.count}},
        backgroundColor:
          'rgba(237, 28, 36, 1)',
      },{
        label: 'Tactic',
        data:  {{counts.tactic.count}},
        backgroundColor:
          'rgba(191, 30, 46, 1)',
        borderColor: 'rgba(0, 0, 0, 0.1)',
        borderWidth: 1,
      },{
        label: 'Technique',
        data:  {{counts.technique.count}},
        backgroundColor:
          'rgba(130 ,24, 44, 1)',
          },{
        label: 'MSSP',
        data:  {{counts.mssp.count}},
        backgroundColor:
          'rgba(167, 169, 172, 1)',
      }
    ]
  },
  options: {
    scales: {
      yAxes: [{
        stacked: true,
        ticks: {
          beginAtZero: true
        }
      }],
      xAxes: [{
        stacked: true,
        ticks: {
          beginAtZero: true
        }
      }]
    }
  }
});


var config = {
    type: 'bar',
    data: {
        labels: SUB_STEPS = ["1.A.1", "1.A.2", "1.A.3", "1.A.4", "1.B.1", "1.B.2", "2.A.1", "2.A.2", "2.A.3", "2.A.4", "2.A.5", "2.B.1", "3.A.1", "3.A.2", "3.B.1", "3.B.2", "3.B.3", "3.B.4", "3.B.5", "3.C.1", "4.A.1", "4.A.2", "4.A.3", "4.B.1", "4.B.2", "4.B.3", "4.B.4", "4.C.1", "4.C.2", "4.C.3", "4.C.4", "4.C.5", "4.C.6", "4.C.7", "4.C.8", "4.C.9", "4.C.10", "4.C.11", "4.C.12", "5.A.1", "5.B.1", "6.A.1", "6.A.2", "6.A.3", "6.B.1", "6.C.1", "7.A.1", "7.A.2", "7.A.3", "7.B.1", "7.B.2", "7.B.3", "7.B.4", "8.A.1", "8.A.2", "8.A.3", "8.B.1", "8.B.2", "8.C.1", "8.C.2", "8.C.3", "9.A.1", "9.A.2", "9.B.1", "9.B.2", "9.B.3", "9.B.4", "9.B.5", "9.B.6", "9.B.7", "9.B.8", "9.C.1", "9.C.2", "9.C.3", "9.C.4", "10.A.1", "10.B.1", "10.B.2", "10.B.3", "11.A.1", "11.A.2", "11.A.3", "11.A.4", "11.A.5", "11.A.6", "11.A.7", "11.A.8", "11.A.9", "11.A.10", "11.A.11", "11.A.12", "11.A.13", "11.A.14", "11.A.15", "12.A.1", "12.A.2", "12.B.1", "12.C.1", "12.C.2", "13.A.1", "13.B.1", "13.C.1", "13.D.1", "14.A.1", "14.A.2", "14.A.3", "14.B.1", "14.B.2", "14.B.3", "14.B.4", "14.B.5", "14.B.6", "15.A.1", "15.A.2", "16.A.1", "16.B.1", "16.B.2", "16.C.1", "16.C.2", "16.D.1", "16.D.2", "17.A.1", "17.B.1", "17.B.2", "17.C.1", "17.C.2", "18.A.1", "18.A.2", "19.A.1", "19.A.2", "19.B.1", "19.B.2", "19.C.1", "19.C.2", "20.A.1", "20.A.2", "20.A.3", "20.B.1", "20.B.2", "20.B.3"],
        datasets: [{
            label: 'None',
            backgroundColor: 'rgba(129, 130, 133, 1)',
            data: {{sub_step.none.count}},
            fill: false,
        },
        {
            label: 'Telemetry',
            backgroundColor: 'rgba(88, 88, 90, 1)',
            data: {{sub_step.telemetry.count}},
            fill: false,
        },
        {
            label: 'General',
            backgroundColor: 'rgba(237, 28, 36, 1)',
            data: {{sub_step.general.count}},
            fill: false,
        },
        {
            label: 'Tactic',
            backgroundColor:   'rgba(191, 30, 46, 1)',
            data: {{sub_step.tactic.count}},
            fill: false,
        },
        {
            label: 'Technique',
            backgroundColor:  'rgba(130 ,24, 44, 1)',
            data: {{sub_step.technique.count}},
            fill: false,
        },
        {
            label: 'MSSP',
            backgroundColor: 'rgba(167, 169, 172, 1)',
            data: {{sub_step.mssp.count}},
            fill: false,
        }]
    },
    options: {
        responsive: true,
        tooltips: {
            mode: 'index',
            intersect: false,
        },
        hover: {
            mode: 'nearest',
            intersect: true
        },
        scales: {
            xAxes: [{
                display: true,
                stacked: true,
                scaleLabel: {
                    display: true,
                    labelString: 'Sub Step'
                }
            }],
            yAxes: [{
                display: true,
                stacked: true,
                scaleLabel: {
                    display: true,
                    labelString: 'Amount'
                },
                ticks: {
                    min: 0,
                    max: 5,

                    // forces step size to be 5 units
                    stepSize: 1
                }
            }]
        }
    }
};

window.onload = function() {
    var ctx = document.getElementById('canvas').getContext('2d');
    window.myLine = new Chart(ctx, config);
};

</script>

{% endblock %}